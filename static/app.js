$(function(){function n(n){var e=n.xAxisExtremes(),t=e.shift(),o=e.shift();(!a||a>t)&&(a=t),(!u||o>u)&&(u=o)}function e(n){var e=["component","timezone"],t=[],o=n.series[0];_.each(o.columns,function(n,o){_.contains(e,n)&&t.push(o)}),t=t.reverse(),_.each(t,function(n){o.columns.splice(n,1)}),_.each(o.values,function(n){_.each(t,function(e){n.splice(e,1)})})}function t(n){var e=[],t=n.series[0],o=t.columns,i=t.values;return e.push(o),_.each(i,function(n){e.push(n.join(","))}),e.join("\n")}function o(n,o){var i=document.getElementById(n);e(o);var r=t(o),a=$("#"+n+"-container").width();return new Dygraph(i,r,{width:a,height:400,series:{value:{strokeWidth:2,strokePattern:[4,1]},anomalyScore:{axis:"y2",color:"orange"},anomalyLikelihood:{axis:"y2",color:"red"}},axes:{y2:{valueRange:[0,1.1]}},legend:"follow",labelsSeparateLines:!0})}function i(n,e){return o(n,e)}function r(){var n=moment(),e=[moment.duration(10,"minutes"),moment.duration(1,"hour"),moment.duration(3,"hours"),moment.duration(6,"hours"),moment.duration(12,"hours"),moment.duration(1,"day"),moment.duration(3,"days"),moment.duration(1,"week")],t=$("#sinceDropDownList"),o=[];_.each(e,function(e){var t=n.subtract(e).unix(),i=$("<a>",{href:"?since="+t,text:e.humanize()}),r=$("<li>");r.append(i),o.push(r)}),t.append(o)}var a,u,s=($("#chart-container"),[]),c=2e3,l=5e3;$.getJSON("/_data/sensors",function(e){var t=l,o=window.STHTMB.utils.getUrlVars();void 0!==o.limit?t=o.limit:window.location.href.indexOf("/charts")>-1&&(t=c),_.each(e,function(r){var c="/_data/sensor/"+r+"?limit="+t;o.since&&(c+="&since="+o.since);var l=r.replace("/","_").replace(/\+/g,"-");document.getElementById(l)&&$.getJSON(c,function(t){var o=i(l,t);n(o),s.push(o),s.length==e.length&&_.each(s,function(n){n.updateOptions({dateWindow:[a,u]})})})})}),r()}),$(function(){function n(){var n=window.location.href.indexOf("?"),e="";return n>1&&(e=window.location.href.slice(window.location.href.indexOf("?")+1)),e}function e(){for(var e,t=[],o=n().split("&"),i=0;i<o.length;i++)e=o[i].split("="),t.push(e[0]),t[e[0]]=e[1];return t}window.STHTMB={utils:{getUrlQueryString:n,getUrlVars:e}}});